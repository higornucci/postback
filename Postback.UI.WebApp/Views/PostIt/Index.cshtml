@model IEnumerable<Postback.UI.WebApp.ViewModels.CategoriaVm>
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div class="master">
    <div class="topoMobile">

        <img src="@Url.Content("~/Content/img/logo-postback.jpg")" alt="PostBack">
        <div class="adicionar"></div>

    </div>
    <div style="background-color: #8BDA80;padding: 10PX;margin: 10px;border-radius: 5px;font-style: italic;display:none" id="MensagemSucesso"></div>
    <div class="conteudoMobile">
        <form id="frmPostIt" action="@Url.Action("Post", "PostIt")" method="POST">
            <div class="styled-select">                
                <select id="CategoriaId" name="CategoriaId">
                    <option value=""></option>
                    @foreach (var item in Model)
                    {
                        <option value="@item.Id" data-categoriacor="@item.CorHexadecimal">@item.Descricao</option>                        
                    }
                </select>
            </div>

            <input id="Conteudo" type="text" name="Conteudo" maxlength="90">
            <input id="TagNome" type="text" name="TagNome" >

            <input type="button" id="enviar" value="enviar" name="enviar" />
        </form>
    </div>

</div>

@section scripts
{
    <link href="@Url.Content("~/Content/themes/base/minified/jquery-ui.min.css")" rel="stylesheet" />
    <script src="~/Scripts/jquery-1.10.2.js"></script>
    <script src="~/Scripts/jquery.signalR-2.0.2.js"></script>
    <script src="~/Scripts/jquery-ui-1.10.4.min.js"></script>
    <script src="~/signalr/hubs"></script>

    <script>

        $(function () {

            $("#TagNome").autocomplete({
                source: "@Url.Action("SugerirTags", "PostIt")",
                minLength: 2,
            });

            var hub = $.connection.postItHub;

            $.connection.hub.start().done(function () {

                $("#enviar").click(function () {

                    var frm = $("#frmPostIt");
                    var dados = frm.serialize();
                    $.post("@Url.Action("Post", "PostIt")", dados, function () {

                        hub.server.enviarNovoPostIt($("#Conteudo").val(), $("#TagNome").val(), $("#CategoriaId").val(), $("#CategoriaId option:selected").data("categoriacor"));
                        frm[0].reset();
                        $("#MensagemSucesso").show().html("PostIt colado!");

                    }); // post

                }); // enviar

            }); // connection

        }); // $

    </script>
}
