<!DOCTYPE html>
<html>
<head>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="~/Content/lib/css/format.css" rel="stylesheet" />
    <title>@ViewBag.Title</title>

    @Styles.Render("~/Content/css")
    @Scripts.Render("~/bundles/modernizr")

</head>
<body>

    <h1>title</h1>

    <div class="master">

     <form id="frmPostIt" action="@Url.Action("Post", "PostIt")">
        <div class="styled-select">
             @Html.DropDownList("CategoriaId", ViewBag.Categorias as SelectList)
        </div>

         @Html.TextBox("Conteudo")
         @Html.TextBox("TagNome")

    <input type="button" id="enviar" value="enviar" name="enviar" />
     </form>
</div>

@section scripts {
    
    <link href="@Url.Content("~/Content/themes/base/minified/jquery-ui.min.css")" rel="stylesheet" />
    <script src="~/Scripts/jquery-1.10.2.js"></script>
    <script src="~/Scripts/jquery.signalR-2.0.2.js"></script>
    <script src="~/Scripts/jquery-ui-1.10.4.min.js"></script>
    <script src="~/signalr/hubs"></script>

    <script>

        $(function() {

            $("#TagNome").autocomplete({
                source: "/PostIt/SugerirTags",
                minLength: 2,
            });

            var hub = $.connection.postItHub;

            $.connection.hub.start().done(function() {

                $("#enviar").click(function() {

                    var frm = $("#frmPostIt");
                    var dados = frm.serialize();
                    $.post("@Url.Action("Post", "PostIt")", dados).success(function() {

                        frm[0].reset();                        
                    hub.server.enviarNovoPostIt({ "Texto": "Vai ficar o bicho" });
                        // mensagem de sucesso
                    });

                });
                });
            });

    </script>
}

</body>
</html>
